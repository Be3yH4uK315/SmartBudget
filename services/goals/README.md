# –°–µ—Ä–≤–∏—Å –¶–µ–ª–µ–π (Goals Service)

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ —Ü–µ–ª—è–º–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ SmartBudget. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–π —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, —Ä–∞—Å—á–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–µ–ª–µ–π.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ó–∞–ø—É—Å–∫](#–∑–∞–ø—É—Å–∫)
- [API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
- [Kafka –°–æ–±—ã—Ç–∏—è](#kafka-—Å–æ–±—ã—Ç–∏—è)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [Docker](#docker)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

## ÔøΩÔøΩ –û–±–∑–æ—Ä

–°–µ—Ä–≤–∏—Å —Ü–µ–ª–µ–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¶–µ–ª—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π —Å —Ü–µ–ª–µ–≤–æ–π —Å—É–º–º–æ–π –∏ –¥–∞—Ç–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –∫–∞–∂–¥–æ–π —Ü–µ–ª–∏
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ª–µ–π –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ (—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–π
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ü–µ–ª–µ–π —á–µ—Ä–µ–∑ —Ç–µ–≥–∏

### –†–∞—Å—á–µ—Ç—ã –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ –†–∞—Å—á–µ—Ç –¥–Ω–µ–π –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–µ–ª–∏
- ‚úÖ –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–µ–ª–∏
- ‚úÖ –†–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–∞ –¥–æ —Ü–µ–ª–µ–≤–æ–π —Å—É–º–º—ã

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ Classification
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ü–µ–ª—è–º –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ Kafka –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ü–µ–ª–µ–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Dead Letter Queue (DLQ)
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Arq

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ Kafka –∫–æ–Ω—Å—å—é–º–µ—Ä —Å –±–∞—Ç—á–∏–Ω–≥–æ–º –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –≤ DLQ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- ‚úÖ Health check —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î –∏ Redis

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|-----------|
| **Python** | 3.12 | –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| **FastAPI** | Latest | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π web framework |
| **SQLAlchemy** | Latest | ORM —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π |
| **PostgreSQL** | 16 | –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **Redis** | 7+ | –û—á–µ—Ä–µ–¥—å Arq, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **Kafka** | 7.5.0 | Event streaming |
| **Arq** | 0.26.3 | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á |
| **Prometheus** | Latest | –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **Alembic** | Latest | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î |

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          API –ö–ª–∏–µ–Ω—Ç / –§—Ä–æ–Ω—Ç–µ–Ω–¥           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   FastAPI App      ‚îÇ
        ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
        ‚îÇ ‚îÇ API Routes     ‚îÇ ‚îÇ
        ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
        ‚îÇ ‚îÇ Services       ‚îÇ ‚îÇ
        ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
        ‚îÇ ‚îÇ Repositories   ‚îÇ ‚îÇ
        ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ            ‚îÇ              ‚îÇ              ‚îÇ
   ‚ñº            ‚ñº              ‚ñº              ‚ñº
PostgreSQL   Redis            Kafka          Arq
(Goals)     (Arq Queue)   (Events from    (Tasks:
                           Classification) notifications)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **API Layer** (`api/routes.py`)
   - FastAPI –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Pydantic schemas
   - Dependency injection –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

2. **Service Layer** (`services/service.py`)
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª—è–º–∏
   - –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   - –°–æ–∑–¥–∞–Ω–∏–µ Kafka —Å–æ–±—ã—Ç–∏–π

3. **Repository Layer** (`infrastructure/db/repositories.py`)
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ü–µ–ª—è–º–∏
   - Unit of Work –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - SQLAlchemy ORM –∑–∞–ø—Ä–æ—Å—ã

4. **Infrastructure Layer** (`infrastructure/`)
   - Kafka Consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - Kafka Producer –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
   - –†–∞–±–æ—Ç–∞ —Å Redis —á–µ—Ä–µ–∑ Arq

5. **Core Layer** (`core/`)
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ò—Å–∫–ª—é—á–µ–Ω–∏—è
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ
- Python 3.12+
- Docker & Docker Compose (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è)
- 2+ GB RAM, 500MB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- PostgreSQL 16+
- Redis 7+
- Apache Kafka 7.5.0+ —Å Zookeeper
- –°–µ—Ä–≤–∏—Å Authentication (–¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –°–µ—Ä–≤–∏—Å Classification (–¥–ª—è —Å–æ–±—ã—Ç–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/4y8a4ek/SmartBudget.git
cd SmartBudget/services/goals
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Unix/MacOS
python3.12 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
alembic revision --autogenerate -m "Initial schema"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

## üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–§–∞–π–ª `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# --- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DB__DB_URL=postgresql+asyncpg://postgres:password@localhost:5432/goals_db
DB__DB_POOL_SIZE=20
DB__DB_MAX_OVERFLOW=10

# --- Kafka Topics
KAFKA__KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA__KAFKA_GOALS_GROUP_ID=goals-group
KAFKA__KAFKA_TOPIC_TRANSACTION_GOAL=transaction.goal
KAFKA__KAFKA_TOPIC_BUDGET_EVENTS=budget.goals.events
KAFKA__KAFKA_TOPIC_BUDGET_NOTIFICATION=budget.notification
KAFKA__KAFKA_TOPIC_TRANSACTION_DLQ=goals.transaction.dlq

# --- Redis Arq
ARQ__REDIS_URL=redis://localhost:6379/0
ARQ__ARQ_QUEUE_NAME=goals_tasks

# --- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
APP__LOG_LEVEL=INFO
APP__TZ=UTC
APP__FRONTEND_URL=http://localhost:3000
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ infra/.env

```bash
# Zookeeper
ZOOKEEPER_CLIENT_PORT=2181
ZOOKEEPER_TICK_TIME=2000

# Kafka
KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1
ALLOW_PLAINTEXT_LISTENER=yes

# Goals PostgreSQL
GOALS_POSTGRES_USER=postgres
GOALS_POSTGRES_PASSWORD=password
GOALS_POSTGRES_DB=goals_db
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å Docker Compose

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (goals, postgres, redis, kafka, zookeeper)
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f goals_service

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ Docker (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ë–î)

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: FastAPI —Å–µ—Ä–≤–µ—Ä
uvicorn app.main:app --reload --host 0.0.0.0 --port 8002

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Kafka Consumer (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
python app/run_consumer.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: Arq Worker (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)
arq app.workers.main.WorkerSettings --watch

# –î–æ—Å—Ç—É–ø –∫ API
# http://localhost:8002/api/v1/goals/docs (Swagger)
```

### Production —Å Gunicorn

```bash
gunicorn app.main:app \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8000 \
  --access-logfile - \
  --error-logfile - \
  --log-level info
```

## üìö API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Interactive Docs
- **Swagger UI**: http://localhost:8002/api/v1/goals/docs
- **ReDoc**: http://localhost:8002/api/v1/goals/redoc

### Health Check

```
GET /api/v1/goals/health
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞ –∏ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

Response: {
  "status": "ok",
  "components": {
    "db": "ok",
    "redis": "ok"
  }
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –¶–µ–ª–∏

```
POST /api/v1/goals/
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Ü–µ–ª–∏

Headers: X-User-Id: {user_id}
Body: {
  "name": "–û—Ç–ø—É—Å–∫ –Ω–∞ –ú–∞–ª—å–¥–∏–≤—ã",
  "target_value": 100000.00,
  "finish_date": "2025-12-31",
  "tags": ["travel", "vacation"]
}

Response: {
  "goal_id": "uuid",
  "user_id": "uuid",
  "name": "–û—Ç–ø—É—Å–∫ –Ω–∞ –ú–∞–ª—å–¥–∏–≤—ã",
  "target_value": 100000.00,
  "current_value": 0.00,
  "finish_date": "2025-12-31",
  "status": "ONGOING",
  "tags": ["travel", "vacation"],
  "created_at": "2026-01-10T..."
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¶–µ–ª–µ–π –ì–ª–∞–≤–Ω–æ–≥–æ –≠–∫—Ä–∞–Ω–∞

```
GET /api/v1/goals/main
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ª–µ–π –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

Headers: X-User-Id: {user_id}

Response: {
  "goals": [
    {
      "goal_id": "uuid",
      "name": "–û—Ç–ø—É—Å–∫ –Ω–∞ –ú–∞–ª—å–¥–∏–≤—ã",
      "target_value": 100000.00,
      "current_value": 25000.00,
      "finish_date": "2025-12-31",
      "status": "ONGOING",
      "days_left": 356,
      "percentage_complete": 25,
      "recommended_payment": 195.89,
      "tags": ["travel"]
    }
  ]
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –°–ø–∏—Å–∫–∞ –í—Å–µ—Ö –¶–µ–ª–µ–π

```
GET /api/v1/goals/
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

Headers: X-User-Id: {user_id}

Response: [
  {
    "goal_id": "uuid",
    "name": "–û—Ç–ø—É—Å–∫ –Ω–∞ –ú–∞–ª—å–¥–∏–≤—ã",
    "target_value": 100000.00,
    "current_value": 25000.00,
    "finish_date": "2025-12-31",
    "status": "ONGOING",
    "percentage_complete": 25,
    "tags": ["travel"]
  }
]
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¶–µ–ª–∏ –ø–æ ID

```
GET /api/v1/goals/{goal_id}
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª–∏

Headers: X-User-Id: {user_id}

Response: {
  "goal_id": "uuid",
  "name": "–û—Ç–ø—É—Å–∫ –Ω–∞ –ú–∞–ª—å–¥–∏–≤—ã",
  "target_value": 100000.00,
  "current_value": 25000.00,
  "finish_date": "2025-12-31",
  "status": "ONGOING",
  "percentage_complete": 25,
  "tags": ["travel"],
  "created_at": "2026-01-10T...",
  "updated_at": "2026-01-10T..."
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¶–µ–ª–∏

```
PATCH /api/v1/goals/{goal_id}
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ü–µ–ª–∏

Headers: X-User-Id: {user_id}
Body: {
  "name": "–û—Ç–ø—É—Å–∫ –≤ –¢–∞–∏–ª–∞–Ω–¥–µ",
  "target_value": 80000.00,
  "finish_date": "2025-11-30",
  "tags": ["travel", "asia"]
}

Response: { —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ }
```

### –£–¥–∞–ª–µ–Ω–∏–µ –¶–µ–ª–∏

```
DELETE /api/v1/goals/{goal_id}
–£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–∏

Headers: X-User-Id: {user_id}

Response: 204 No Content
```

## üì® Kafka –°–æ–±—ã—Ç–∏—è

### –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –°–æ–±—ã—Ç–∏–π

–°–µ—Ä–≤–∏—Å Goals –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ Classification —Å–µ—Ä–≤–∏—Å–∞:

| Topic | Event Type | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------|---------|
| `transaction.goal` | Transaction | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –æ—Ç–Ω–æ—Å—è—â–∞—è—Å—è –∫ —Ü–µ–ª–∏ |
| `budget.goals.events` | Budget Goals Event | –°–æ–±—ã—Ç–∏–µ –æ —Ö–æ–¥–µ —Ü–µ–ª–∏ |
| `budget.notification` | Notification | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ü–µ–ª–∏ |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –°–æ–±—ã—Ç–∏–π –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–±—ã—Ç–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
1. –ü–∞—Ä—Å–∏—Ç—Å—è JSON —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
2. –ù–∞—Ö–æ–¥–∏—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ü–µ–ª—å –ø–æ goal_id
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è current_value —Ü–µ–ª–∏
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å (–µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —Ü–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ ‚Üí ACHIEVED)
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ü–µ–ª–∏
6. –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ DLQ (Dead Letter Queue)

### –û—Ç–ø—Ä–∞–≤–∫–∞ –°–æ–±—ã—Ç–∏–π

```python
# –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ü–µ–ª–∏
{
  "event_type": "goal.created",
  "goal_id": "uuid",
  "user_id": "uuid",
  "name": "–û—Ç–ø—É—Å–∫",
  "target_value": 100000.00,
  "finish_date": "2025-12-31"
}

# –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–∏
{
  "event_type": "goal.achieved",
  "goal_id": "uuid",
  "user_id": "uuid",
  "name": "–û—Ç–ø—É—Å–∫",
  "achieved_at": "2026-01-10T..."
}

# –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
{
  "event_type": "goal.progress_updated",
  "goal_id": "uuid",
  "user_id": "uuid",
  "current_value": 50000.00,
  "percentage_complete": 50,
  "updated_at": "2026-01-10T..."
}
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
goals/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                         # Entry point, lifespan, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ run_consumer.py                 # –ó–∞–ø—É—Å–∫ Kafka consumer
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py             # Dependency injection (get_db, services)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py                   # –í—Å–µ API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py                   # Pydantic Settings, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py                 # SQLAlchemy engine, session factory
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py               # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logging.py                  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas/                    # Pydantic –º–æ–¥–µ–ª–∏ (api, kafka)
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                 # Base ORM model
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py               # SQLAlchemy models (Goal, etc)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories.py         # CRUD operations
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ uow.py                  # Unit of Work –ø–∞—Ç—Ç–µ—Ä–Ω
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ kafka/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ consumer.py             # Kafka consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ producer.py             # Kafka producer –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service.py                  # GoalService —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ serialization.py            # JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (decimal, date)
‚îÇ   ‚îî‚îÄ‚îÄ workers/
‚îÇ       ‚îú‚îÄ‚îÄ main.py                     # Arq WorkerSettings
‚îÇ       ‚îî‚îÄ‚îÄ tasks.py                    # Background –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ alembic/
‚îÇ   ‚îú‚îÄ‚îÄ versions/                       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ env.py                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îÇ   ‚îú‚îÄ‚îÄ script.py.mako                  # –®–∞–±–ª–æ–Ω –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ README
‚îú‚îÄ‚îÄ .dockerignore                       # –§–∞–π–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ Docker
‚îú‚îÄ‚îÄ .env                                # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore                          # –§–∞–π–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ Git
‚îú‚îÄ‚îÄ alembic.ini                         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îú‚îÄ‚îÄ Dockerfile                          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml                  # Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ requirements.txt                    # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app tests/

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_goals_routes.py::test_create_goal
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞

```bash
# Black - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
black app/

# Flake8 - –ª–∏–Ω—Ç–∏–Ω–≥
flake8 app/

# Isort - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
isort app/

# MyPy - type checking (–µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω)
mypy app/
```

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
# –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π
alembic revision --autogenerate -m "Add new goal field"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
alembic downgrade <revision_id>
```

### –†–∞–±–æ—Ç–∞ —Å Kafka –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –°–æ–∑–¥–∞—Ç—å topic –¥–ª—è —Ü–µ–ª–µ–π
docker exec kafka kafka-topics --create \
  --topic transaction.goal \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 1

# –°–æ–∑–¥–∞—Ç—å DLQ topic
docker exec kafka kafka-topics --create \
  --topic goals.transaction.dlq \
  --bootstrap-server localhost:9092 \
  --partitions 1 \
  --replication-factor 1

# –°–ª—É—à–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ topic
docker exec kafka kafka-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic transaction.goal \
  --from-beginning

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
docker exec kafka kafka-console-producer \
  --broker-list localhost:9092 \
  --topic transaction.goal << 'EOF'
{
  "goal_id": "550e8400-e29b-41d4-a716-446655440000",
  "amount": 1000.00,
  "timestamp": "2026-01-10T12:00:00Z"
}
EOF
```

## üê≥ Docker

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker build -t smartbudget-goals:latest .
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker run -p 8002:8000 \
  --env-file .env \
  --name goals-service \
  smartbudget-goals:latest
```

### Docker Compose —Ñ–∞–π–ª –≤–∫–ª—é—á–∞–µ—Ç

```
services:
  goals_service      - FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  goals_postgres     - PostgreSQL –ë–î (–ø–æ—Ä—Ç 5436)
  redis_cache        - Redis –¥–ª—è Arq
  kafka              - Kafka broker
  zookeeper          - Zookeeper –¥–ª—è Kafka

networks:
  smartbudget-net    - –û–±—â–∞—è —Å–µ—Ç—å –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

volumes:
  pg_data_goals      - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ë–î
  redis_data_cache   - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Redis
```

## ÔøΩÔøΩ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL

```
Error: asyncpg.exceptions.CannotConnectNowError: server closed the connection unexpectedly
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Postgres –∑–∞–ø—É—â–µ–Ω –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
docker-compose logs goals_postgres

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ docker-compose, –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down
docker-compose up -d
```

### –û—à–∏–±–∫–∞: Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```
Error: ConnectionError: Error 111 connecting to localhost:6379
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω
redis-cli ping  # –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å PONG

# –ï—Å–ª–∏ Docker Compose –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
docker-compose ps  # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å redis_cache

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Redis
docker-compose restart redis_cache
```

### –û—à–∏–±–∫–∞: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

```
alembic upgrade head
Error: Can't find [alembic] in ./alembic directory
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
rm -rf alembic/__pycache__

# –ü–µ—Ä–µ–ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### Kafka Consumer –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è

```
ERROR: Consumer failed to fetch messages
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. Kafka –∏ Zookeeper –∑–∞–ø—É—â–µ–Ω—ã: `docker-compose ps`
2. Topic —Å–æ–∑–¥–∞–Ω: `docker exec kafka kafka-topics --list --bootstrap-server localhost:9092`
3. Consumer –∑–∞–ø—É—â–µ–Ω: `python app/run_consumer.py`
4. –õ–æ–≥–∏ Consumer: `docker-compose logs goals_service`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å consumer
docker-compose restart goals_service

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
kill $(lsof -t -i :8002)
python app/run_consumer.py
```

### –ó–∞–¥–∞—á–∏ Arq –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

```
ERROR: Arq queue tasks not processing
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. Arq Worker –∑–∞–ø—É—â–µ–Ω
2. Redis –¥–æ—Å—Ç—É–ø–µ–Ω
3. –õ–æ–≥–∏ Worker: `docker-compose logs goals_worker`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker
docker-compose restart goals_worker

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
arq app.workers.main.WorkerSettings --watch
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

```
http://localhost:8000/metrics
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- `http_requests_total` - –≤—Å–µ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `http_exceptions_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `kafka_messages_processed_total` - –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è Kafka
- `kafka_messages_failed_total` - –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ Kafka

### Health Check

```bash
curl http://localhost:8002/api/v1/goals/health

# Response:
{
  "status": "ok",
  "components": {
    "db": "ok",
    "redis": "ok"
  }
}
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¶–µ–ª–∏

### –°—Ç–∞—Ç—É—Å—ã

```
ONGOING    ‚Üí –¶–µ–ª—å –∞–∫—Ç–∏–≤–Ω–∞, –∏–¥–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ
ACHIEVED   ‚Üí –¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
EXPIRED    ‚Üí –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—à–ª–∞, —Ü–µ–ª—å –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
CANCELLED  ‚Üí –¶–µ–ª—å –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
```

### –ü—Ä–æ—Ü–µ—Å—Å –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç Classification —Å–µ—Ä–≤–∏—Å–∞
   ‚Üì
2. Kafka Consumer –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
   ‚Üì
3. –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
   ‚Üì
4. –ü–æ–∏—Å–∫ —Ü–µ–ª–∏ –ø–æ goal_id
   ‚Üì
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ current_value
   ‚Üì
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–æ —Ü–µ–ª–∏?)
   ‚Üì
7. –í–æ–∑–º–æ–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
   ‚Üì
8. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (—Ç—Ä–∞–Ω—Å–∞–∫—Ü–∏—è)
   ‚Üì
9. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ Kafka (goal.progress_updated)
   ‚Üì
10. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ DLQ
```

## ü§ù Contributing

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É: `git checkout -b feature/your-feature`
2. –°–æ–≤–µ—Ä—à–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–ø—É—à—å—Ç–µ: `git push origin feature/your-feature`
3. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –°–º. LICENSE —Ñ–∞–π–ª.

## üë• –ö–æ–º–∞–Ω–¥–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π SmartBudget.

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ø–Ω–≤–∞—Ä—å 2026  
**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π Python**: 3.12+
